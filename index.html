<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChinaBridge Academy | CSCA, SAT, HSK & University Prep</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="translations.js"></script>
    <style>
      .language-switcher {
        background: var(--accent);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        margin-left: 12px;
        transition: opacity 0.2s;
      }
      .language-switcher:hover {
        opacity: 0.9;
      }
      .nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
    </style>
  </head>
  <body>
    <header class="site-header">
      <nav class="nav">
        <div class="logo">ChinaBridge</div>
        <div class="nav-links" id="navLinks">
          <a href="#courses" data-i18n="nav_courses">Courses</a>
          <a href="#tutors" data-i18n="nav_tutors">Tutors</a>
          <a href="#pricing" data-i18n="nav_pricing">Pricing</a>
          <a href="#loginSection" data-i18n="nav_login">Login</a>
        </div>
        <div id="navLoggedIn" style="display:none;gap:20px;" class="nav-links">
          <a href="dashboard.html" data-i18n="nav_dashboard">My Dashboard</a>
          <a href="admin.html" data-i18n="nav_admin">Admin</a>
          <a href="#" onclick="logout(event)" data-i18n="nav_logout">Logout</a>
        </div>
        <button class="nav-cta" data-i18n="nav_start_learning">Start learning</button>
        <button class="language-switcher" id="languageSwitcher" onclick="toggleLanguage()">English</button>
      </nav>
    </header>

    <main>
      <section class="hero">
        <div class="hero-content">
          <p class="eyebrow" data-i18n="hero_eyebrow">Student-founded tutoring platform</p>
          <h1 data-i18n="hero_title">Excel in CSCA, SAT, HSK, HSKK & Chinese University Interviews</h1>
          <p class="hero-subtitle" data-i18n="hero_subtitle">
            ChinaBridge Academy is a student-run platform connecting learners with passionate, high-achieving peer tutors specializing in Chinese, Math, Physics, Chemistry, SAT prep, HSK/HSKK, and China's competitive university admissions process.
          </p>
          <div class="hero-actions">
            <button class="primary" data-i18n="hero_explore">Explore courses</button>
            <button class="secondary" data-i18n="hero_become_tutor">Become a tutor</button>
          </div>
          <div class="hero-stats">
            <div>
              <h3>5</h3>
              <p data-i18n="hero_experts">expert peer tutors</p>
            </div>
            <div>
              <h3>2</h3>
              <p>Tsinghua University accepted</p>
            </div>
            <div>
              <h3>1:1</h3>
              <p>personalized tutoring sessions</p>
            </div>
          </div>
        </div>
      </section>

      <section id="courses" class="section">
        <div class="section-heading">
          <h2 data-i18n="courses_title">Our Courses</h2>
          <p data-i18n="courses_subtitle">Choose from our specialized courses designed to help you excel</p>
        </div>
        <div class="grid three">
          <article class="card">
            <h3 data-i18n="csca_name">CSCA Prep</h3>
            <p data-i18n="csca_desc">Master Chinese language, classics, mathematics, physics, and chemistry with expert guidance</p>
            <ul>
              <li data-i18n="features_tutoring">1:1 tutoring sessions</li>
              <li data-i18n="features_custom">Customized study plans</li>
              <li data-i18n="features_experts">Subject experts available</li>
            </ul>
          </article>
          <article class="card">
            <h3 data-i18n="sat_name">SAT Tutoring</h3>
            <p data-i18n="sat_desc">Strategic SAT preparation with proven techniques to boost your score and college prospects</p>
            <ul>
              <li data-i18n="features_practice">Practice test review</li>
              <li data-i18n="features_skill">Targeted skill building</li>
              <li data-i18n="features_strategy">Strategy sessions</li>
            </ul>
          </article>
          <article class="card">
            <h3 data-i18n="hsk_name">HSK/HSKK & University Prep</h3>
            <p data-i18n="hsk_desc">Ace Chinese language proficiency exams and prepare for China's university interview process</p>
            <ul>
              <li data-i18n="features_hsk">HSK levels 1-6 support</li>
              <li data-i18n="features_speaking">Speaking & conversation practice</li>
              <li data-i18n="features_interview">Interview coaching</li>
            </ul>
          </article>
        </div>
      </section>

      <section class="section highlight">
        <div class="highlight-content">
          <h2 data-i18n="tutors_title">Our Tutors</h2>
          <p data-i18n="tutors_subtitle">
            Meet our talented and passionate peer tutors
          </p>
          <div class="highlight-list">
            <div>
              <h4 data-i18n="proven_success">Proven Success</h4>
              <p data-i18n="proven_desc">Two tutors accepted to Tsinghua University. Learn from students achieving excellence in the most competitive admissions processes.</p>
            </div>
            <div>
              <h4 data-i18n="personalized_approach">Personalized Approach</h4>
              <p data-i18n="personalized_desc">Small group of tutors means you get genuine, customized attention and mentorship tailored to your specific challenges.</p>
            </div>
            <div>
              <h4 data-i18n="recent_experience">Recent Experience</h4>
              <p data-i18n="recent_desc">Our tutors recently completed the same exams and processes you're preparing for, giving them fresh, practical insights.</p>
            </div>
          </div>
        </div>
        <div class="highlight-card">
          <h3 data-i18n="community_title">Our Growing Community</h3>
        </div>
      </section>

      <section id="tutors" class="section">
        <div class="section-heading">
          <h2 data-i18n="tutors_title">Meet our passionate peer tutors</h2>
          <p data-i18n="tutors_subtitle">High-achieving students who excel at the subjects and exams you're preparing for.</p>
        </div>
        <div class="grid three">
          <article class="profile">
            <h3 data-i18n="tutor_phoenix">Phoenix</h3>
            <p data-i18n="tutor_phoenix_desc">CSCA Expert - Chinese, Classics, Math, Physics, and Chemistry</p>
            <div class="profile-meta">
              <span>★★★★★</span>
              <span data-i18n="expert_tutor">Expert tutor</span>
            </div>
            <button data-i18n="book_tutoring">Book tutoring</button>
          </article>
          <article class="profile">
            <h3 data-i18n="tutor_serum">Serum</h3>
            <p data-i18n="tutor_serum_desc">IELTS Expert - Helping students ace English proficiency exams</p>
            <div class="profile-meta">
              <span>★★★★★</span>
              <span data-i18n="expert_tutor">Expert tutor</span>
            </div>
            <button data-i18n="book_tutoring">Book tutoring</button>
          </article>
        </div>
      </section>

      <section id="loginSection" class="section cta">
        <div class="cta-content">
          <h2 data-i18n="login_title">Start your learning journey today</h2>
          <p data-i18n="login_subtitle">
            Create your free account to access courses, schedule tutoring sessions, and track your progress toward academic excellence.
          </p>
        </div>
        
        <div class="auth-container">
          <div class="auth-tabs">
            <button class="auth-tab active" data-tab="login">Login</button>
            <button class="auth-tab" data-tab="register">Sign Up</button>
          </div>
          
          <form id="loginForm" class="cta-form auth-form active">
            <h3 data-i18n="btn_login">Login to your account</h3>
            <div id="loginError" class="error-message" style="display:none;"></div>
            <label>
              <span data-i18n="form_email">Email address</span>
              <input type="email" id="loginEmail" placeholder="you@email.com" required />
            </label>
            <label>
              <span data-i18n="form_password">Password</span>
              <input type="password" id="loginPassword" placeholder="Enter your password" required />
            </label>
            <button type="submit" id="loginBtn" data-i18n="btn_login">Login</button>
            <small><span data-i18n="link_forgot_password">Forgot password?</span> <a href="#" onclick="showForgotPasswordForm(event)" data-i18n="link_reset_here">Reset it here</a></small>
          </form>
          
          <form id="registerForm" class="cta-form auth-form" style="display:none;">
            <h3 data-i18n="btn_create_account">Create your account</h3>
            <div id="registerError" class="error-message" style="display:none;"></div>
            <label>
              <span data-i18n="form_first_name">First Name</span>
              <input type="text" id="firstName" placeholder="First name" />
            </label>
            <label>
              <span data-i18n="form_last_name">Last Name</span>
              <input type="text" id="lastName" placeholder="Last name" />
            </label>
            <label>
              <span data-i18n="form_email">Email address</span>
              <input type="email" id="regEmail" placeholder="you@email.com" required />
            </label>
            <label>
              <span data-i18n="form_password">Password</span>
              <input type="password" id="regPassword" placeholder="Create a password (min 6 characters)" required />
            </label>
            <label>
              <span data-i18n="form_confirm_password">Confirm Password</span>
              <input type="password" id="confirmPassword" placeholder="Confirm password" required />
            </label>
            <button type="submit" id="registerBtn" data-i18n="btn_signup">Create Account</button>
            <small>By signing up, you agree to our Terms & Privacy Policy.</small>
          </form>
          
          <form id="forgotPasswordForm" class="cta-form auth-form" style="display:none;">
            <h3>Reset your password</h3>
            <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 0.9rem;">
              Enter your email address and we'll send you a link to reset your password.
            </p>
            <div id="forgotError" class="error-message" style="display:none;"></div>
            <label>
              Email address
              <input type="email" id="forgotEmail" placeholder="you@email.com" required />
            </label>
            <button type="submit" id="forgotBtn">Send Reset Link</button>
            <small><a href="#" onclick="backToLogin(event)" style="color: var(--accent); cursor: pointer;">Back to Login</a></small>
          </form>
          
          <div id="successMessage" class="success-message" style="display:none;"></div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div>
        <h3>ChinaBridge Academy</h3>
        <p>Student-founded tutoring platform connecting learners with high-achieving peer mentors.</p>
      </div>
      <div class="footer-links">
        <a href="#courses">Tutoring</a>
        <a href="#tutors">Our Tutors</a>
        <a href="#pricing">Pricing</a>
        <a href="#loginSection">Login</a>
      </div>
      <p class="copyright">© 2025 ChinaBridge Academy. All rights reserved.</p>
    </footer>

    <script>
      // API Configuration
      const API_BASE_URL = '/api';
      let currentUser = null;

      // Tab switching functionality
      document.querySelectorAll('.auth-tab').forEach(tab => {
        tab.addEventListener('click', function(e) {
          e.preventDefault();
          const tabName = this.getAttribute('data-tab');
          
          // Update active tab
          document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
          this.classList.add('active');
          
          // Update active form
          document.querySelectorAll('.auth-form').forEach(form => form.style.display = 'none');
          if (tabName === 'login') {
            document.getElementById('loginForm').style.display = 'block';
          } else {
            document.getElementById('registerForm').style.display = 'block';
          }
        });
      });

      // Login Form Handler
      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        const errorDiv = document.getElementById('loginError');
        const loginBtn = document.getElementById('loginBtn');
        
        errorDiv.style.display = 'none';
        loginBtn.disabled = true;
        loginBtn.textContent = 'Logging in...';
        
        try {
          const response = await fetch(`${API_BASE_URL}/login`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email, password })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            currentUser = data;
            // Save with timestamp for session management
            const sessionData = {
              ...data,
              loginTime: new Date().getTime()
            };
            localStorage.setItem('currentUser', JSON.stringify(sessionData));
            console.log('[Login] User logged in and saved to localStorage:', data.email);
            showSuccessMessage('Login successful! Redirecting to dashboard...');
            setTimeout(() => {
              window.location.href = 'dashboard.html';
            }, 1500);
          } else {
            errorDiv.textContent = data.error || 'Login failed';
            errorDiv.style.display = 'block';
          }
        } catch (error) {
          errorDiv.textContent = 'Error connecting to server: ' + error.message;
          errorDiv.style.display = 'block';
          console.error('[Login] Error:', error);
        } finally {
          loginBtn.disabled = false;
          loginBtn.textContent = 'Login';
        }
      });

      // Register Form Handler
      document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const firstName = document.getElementById('firstName').value;
        const lastName = document.getElementById('lastName').value;
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const errorDiv = document.getElementById('registerError');
        const registerBtn = document.getElementById('registerBtn');
        
        errorDiv.style.display = 'none';
        
        // Validation
        if (password !== confirmPassword) {
          errorDiv.textContent = 'Passwords do not match';
          errorDiv.style.display = 'block';
          return;
        }
        
        if (password.length < 6) {
          errorDiv.textContent = 'Password must be at least 6 characters';
          errorDiv.style.display = 'block';
          return;
        }
        
        registerBtn.disabled = true;
        registerBtn.textContent = 'Creating account...';
        
        try {
          const response = await fetch(`${API_BASE_URL}/register`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email,
              password,
              first_name: firstName,
              last_name: lastName
            })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            showSuccessMessage('Account created successfully! Switching to login...');
            setTimeout(() => {
              document.getElementById('registerForm').reset();
              document.querySelectorAll('.auth-tab')[0].click();
            }, 2000);
          } else {
            errorDiv.textContent = data.error || 'Registration failed';
            errorDiv.style.display = 'block';
          }
        } catch (error) {
          errorDiv.textContent = 'Error connecting to server: ' + error.message;
          errorDiv.style.display = 'block';
        } finally {
          registerBtn.disabled = false;
          registerBtn.textContent = 'Create Account';
        }
      });

      // Forgot Password Form Handler
      document.getElementById('forgotPasswordForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const email = document.getElementById('forgotEmail').value;
        const errorDiv = document.getElementById('forgotError');
        const forgotBtn = document.getElementById('forgotBtn');
        
        errorDiv.style.display = 'none';
        forgotBtn.disabled = true;
        forgotBtn.textContent = 'Sending...';
        
        try {
          const response = await fetch(`${API_BASE_URL}/forgot-password`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ email })
          });
          
          const data = await response.json();
          
          if (response.ok) {
            showSuccessMessage('Reset link sent! Check your email for instructions.');
            setTimeout(() => {
              document.getElementById('forgotPasswordForm').reset();
              document.querySelectorAll('.auth-tab')[0].click();
            }, 2000);
          } else {
            errorDiv.textContent = data.error || 'Failed to send reset link';
            errorDiv.style.display = 'block';
          }
        } catch (error) {
          errorDiv.textContent = 'Error connecting to server: ' + error.message;
          errorDiv.style.display = 'block';
        } finally {
          forgotBtn.disabled = false;
          forgotBtn.textContent = 'Send Reset Link';
        }
      });

      function showForgotPasswordForm(e) {
        e.preventDefault();
        document.querySelectorAll('.auth-form').forEach(form => form.style.display = 'none');
        document.getElementById('forgotPasswordForm').style.display = 'block';
      }

      function backToLogin(e) {
        e.preventDefault();
        document.querySelectorAll('.auth-form').forEach(form => form.style.display = 'none');
        document.getElementById('loginForm').style.display = 'block';
      }

      function showSuccessMessage(message) {
        const successDiv = document.getElementById('successMessage');
        successDiv.textContent = message;
        successDiv.style.display = 'block';
        setTimeout(() => {
          successDiv.style.display = 'none';
        }, 4000);
      }

      // Check if user is logged in on page load
      window.addEventListener('load', function() {
        const savedUser = localStorage.getItem('currentUser');
        if (savedUser) {
          try {
            currentUser = JSON.parse(savedUser);
            console.log('[Session] User already logged in:', currentUser.email);
            updateNavForLoggedInUser();
            hideLoginSection();
          } catch (e) {
            console.error('[Session] Failed to parse saved user:', e);
            localStorage.removeItem('currentUser');
          }
        } else {
          console.log('[Session] No user logged in');
        }
      });

      function updateNavForLoggedInUser() {
        // Hide login nav and show logged-in nav
        document.getElementById('navLinks').style.display = 'none';
        document.getElementById('navLoggedIn').style.display = 'flex';
      }

      function hideLoginSection() {
        // Hide the login/register section when user is already logged in
        const loginSection = document.getElementById('loginSection');
        if (loginSection) {
          loginSection.style.display = 'none';
        }
      }

      function logout(e) {
        e.preventDefault();
        localStorage.removeItem('currentUser');
        window.location.href = 'index.html';
      }

      function toggleLanguage() {
        setLanguage(currentLanguage === 'th' ? 'en' : 'th');
      }
    </script>
  </body>
</html>
